<!DOCTYPE html>
<html lang="en">
    <!--imports-->
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- import used for animation-->
<script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v5.0.0/dist/aframe-extras.min.js"></script>
<body style="margin : 0px; overflow: hidden;">
    <!-- create scene and set to use barcodes for detection-->
    <a-scene embeddded arjs = 'detectionMode: mono_and_matrix; matrixCodeType:3x3;'>
        <!-- import assets -->
        <a-assets>
            <a-asset-item id='pacman-glb' src = 'pacman.glb'></a-asset-item>

        </a-assets>
        <!-- set marker entity and select marker type-->
        <a-marker type = 'barcode' value = '5'>
            
            <!-- create entity from imported asset anchored to marker -->
            <a-entity id = 'pacman' 
            gltf-model = '#pacman-glb' 
            rotation = '-90 0 0' 
            scale = '0.2 0.2 0.2' 
            animation-mixer>
            </a-entity>

            <!-- create text entity-->
            <a-text id = 'myText' 
            value= 'Hello, world!' 
            color = 'blue' 
            position = '0 -4 -1' 
            rotation='-90 0 0' 
            scale='2 2 2'
            align = 'center'>
            </a-text>

        </a-marker>

        <a-entity camera></a-entity>

    </a-scene>
</body>
    <script>
        const interval = 100;

        const maxX = 1.0;
        const minX = -1.0;

        let mySphere = document.getElementById('pacman');
        let myText = document.getElementById('myText');

        let cycleFlag = true;
 
        let mySphereVect = {
            x: 0.0,
            xDot:0.1, 
            rot:180
        };

        let counter = 0;

        function move(){
            mySphereVect.x = mySphereVect.x + mySphereVect.xDot;
            mySphere.setAttribute('position', mySphereVect.x + ' '+  0.0 + ' ' + 0.0);
            if(mySphereVect.x > maxX || mySphereVect.x<minX){
                cycleFlag = !cycleFlag;
                mySphereVect.xDot = mySphereVect.xDot*-1;
                if(cycleFlag){
                    mySphere.setAttribute('rotation', -90.0 + ' ' + 0.0 + ' ' + 0.0);
                }
                else{
                    mySphere.setAttribute('rotation', 90.0 + ' ' + 180.0 + ' ' + 0.0);
                    myText.setAttribute('value', 'Pocman has done '+ counter +' laps!');
                    counter++;
                }
            }
        }

        window.setInterval(move,interval);

    </script>
</html>